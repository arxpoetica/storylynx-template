<svelte:window bind:scrollY on:scroll={rejigger} on:resize={rejigger}/>

<div class:zoomshow class="zoom">
	<div class="close h6" on:click={() => zoomshow = false}>
		<div class="svg">
			<Close/>
		</div>
		Close
	</div>
	<div class="shell">
		<div bind:this={box} class="box" on:mousemove={event => pos = { x: event.clientX, y: event.clientY }}>
			<div class="pan" style={pan_style}>
				<LazyImg {src} {alt} {width} {height}/>
				<!-- <LazyImg src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Monasterio_Khor_Virap%2C_Armenia%2C_2016-10-01%2C_DD_25.jpg/2560px-Monasterio_Khor_Virap%2C_Armenia%2C_2016-10-01%2C_DD_25.jpg" {alt} {width} {height}/> -->
			</div>
		</div>
	</div>
</div>

<script>
	import Close from '@johnny/svg/icon-close.svelte'
	import LazyImg from '@johnny/svelte/LazyImg.svelte'

	export let zoomshow = false

	export let src
	export let alt = 'No information present about this image.'
	export let width = 100
	export let height = 100

	let box
	let scrollY
	let pos = { x: width / 2, y: height / 2 }
	$: bounds = box ? box.getBoundingClientRect() : false

	$: pos_x = pos.x + 1 - bounds.x
	$: boundedX = pos_x < 0 ? bounds.width / 2 : pos_x > bounds.width ? bounds.width / 2 : pos_x
	$: translateX = (boundedX / bounds.width) * (width - bounds.width) * -1

	$: pos_y = pos.y + 1 - bounds.y
	$: boundedY = pos_y < 0 ? bounds.height / 2 : pos_y > bounds.height ? bounds.height / 2 : pos_y
	$: translateY = (boundedY / bounds.height) * (height - bounds.height) * -1

	$: pan_style = [
		`width:${width}rem;`,
		`height:${height}rem;`,
		'transform:',
		` translateX(${translateX}rem)`,
		` translateY(${translateY}rem)`,
		';',
	].join('')
	const rejigger = () => bounds = box.getBoundingClientRect()
</script>

<style type="text/scss">
	.zoom {
		display: flex;
		position: fixed;
		top: 0;
		right: 0;
		left: 0;
		bottom: 0;
		padding: 65rem;
		background-color: rgba(255, 255, 255, 0.8);
		opacity: 0;
		// transition: opacity 1s ease-in-out;
		z-index: $z-back-modal;
		pointer-events: none;
		&.zoomshow {
			opacity: 1;
			pointer-events: all;
		}
	}
	.close {
		display: flex;
		align-items: center;
		position: absolute;
		top: 25rem;
		left: 25rem;
		cursor: pointer;
	}
	.svg {
		width: 21rem;
		height: 21rem;
		margin-right: 6rem;
	}
	.shell {
		display: flex;
		overflow: hidden;
		width: 100%;
		background-color: white;
		border: 10rem solid white;
		box-shadow: 0 0 2rem rgba(0, 0, 0, 0.1);
	}
	.box {
		overflow: hidden;
	}
	.pan {
		position: relative;
		top: 0;
		left: 0;
		transform: translateX(0) translateY(0);
		transition: transform 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}
</style>
